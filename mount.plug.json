{
  "name": "mount",
  "requiredPermissions": [
    "fs"
  ],
  "functions": {
    "readPageMounted": {
      "pageNamespace": {
        "pattern": "^ðŸšª .+",
        "operation": "readPage"
      },
      "code": "(() => { var mod=(()=>{var T=Object.create;var a=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var v=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var k=(e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})},p=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of F(t))!N.call(e,n)&&n!==r&&a(e,n,{get:()=>t[n],enumerable:!(i=$(t,n))||i.enumerable});return e};var E=(e,t,r)=>(r=e!=null?T(b(e)):{},p(t||!e||!e.__esModule?a(r,\"default\",{value:e,enumerable:!0}):r,e)),L=e=>p(a({},\"__esModule\",{value:!0}),e);var I={};k(I,{default:()=>A});var c=self.syscall;async function m(e){return c(\"fs.readFile\",e)}typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;async function l(e){return s(\"markdown.parseMarkdown\",e)}function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...g(i,t)];return r}function f(e,t){if(e.children){let r=e.children.slice();for(let i of r){let n=t(i);if(n!==void 0){let o=e.children.indexOf(i);n?e.children.splice(o,1,n):e.children.splice(o,1)}else f(i,t)}}}function P(e,t){return g(e,r=>r.type===t)[0]}function d(e){let t=[];if(e.text!==void 0)return e.text;for(let r of e.children)t.push(d(r));return t.join(\"\")}async function h(e){return s(\"space.readPage\",e)}var M=E(v(\"yaml\")),x=\"\\u{1F6AA} \",u=[];async function O(){let e=\"\";try{let{text:o}=await h(\"MOUNTS\");e=o}catch{u=[];return}let t=await l(e),r=P(t,\"CodeText\");if(!r){console.error(\"Could not find yaml block in MOUNTS\");return}let i=r.children[0].text,n=M.default.parse(i);if(!Array.isArray(n)){console.error(\"Invalid MOUNTS file, should have array of mount points\");return}for(let o of n){if(!o.prefix){console.error(\"Invalid mount point, no prefix specified\",o);return}if(!o.path){console.error(\"Invalid mount point, no path specified\",o);return}o.perm||(o.perm=\"rw\"),o.path.startsWith(\"file:\")?(o.protocol=\"file\",o.path=o.path.substring(5)):(o.protocol=\"http\",o.path+=\"/fs\")}u=n}async function w(e,t){t=`${x}${t}`;let r=await l(e);return f(r,i=>{i.type===\"WikiLinkPage\"&&(i.children[0].text=t+i.children[0].text)}),e=d(r),e}function W(e){e=e.substring(x.length);for(let t of u)if(e.startsWith(t.prefix))return{resolvedPath:`${t.path}/${e.substring(t.prefix.length)}`,mountPoint:t};throw new Error(\"No mount point found for \"+e)}async function y(e){await O();let{resolvedPath:t,mountPoint:r}=W(e);if(r.protocol===\"file\"){let{text:i,meta:n}=await m(`${t}.md`);return{text:await w(i,r.prefix),meta:{name:e,lastModified:n.lastModified,perm:r.perm}}}else{let i=await fetch(t,{method:\"GET\",headers:S(r)});if(i.status!==200)throw new Error(`Failed to read page: ${i.status}: ${await i.text()}`);if(i.headers.get(\"X-Status\")===\"404\")throw new Error(\"Page not found\");let n=await i.text();return{text:await w(n,r.prefix),meta:{name:e,lastModified:+(i.headers.get(\"Last-Modified\")||\"0\"),perm:i.headers.get(\"X-Permission\")||\"rw\"}}}}function S(e){return{Authorization:e.password?`Bearer ${e.password}`:\"\"}}var A=y;return L(I);})();\n return mod;})()"
    },
    "writePageMounted": {
      "pageNamespace": {
        "pattern": "^ðŸšª .+",
        "operation": "writePage"
      },
      "code": "(() => { var mod=(()=>{var y=Object.create;var a=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var N=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var v=(e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})},p=(e,t,r,n)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let i of $(t))!b.call(e,i)&&i!==r&&a(e,i,{get:()=>t[i],enumerable:!(n=T(t,i))||n.enumerable});return e};var k=(e,t,r)=>(r=e!=null?y(F(e)):{},p(t||!e||!e.__esModule?a(r,\"default\",{value:e,enumerable:!0}):r,e)),E=e=>p(a({},\"__esModule\",{value:!0}),e);var I={};v(I,{default:()=>A});var c=self.syscall;async function m(e,t){return c(\"fs.writeFile\",e,t)}typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;async function l(e){return s(\"markdown.parseMarkdown\",e)}function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let n of e.children)r=[...r,...g(n,t)];return r}function f(e,t){if(e.children){let r=e.children.slice();for(let n of r){let i=t(n);if(i!==void 0){let o=e.children.indexOf(n);i?e.children.splice(o,1,i):e.children.splice(o,1)}else f(n,t)}}}function P(e,t){return g(e,r=>r.type===t)[0]}function d(e){let t=[];if(e.text!==void 0)return e.text;for(let r of e.children)t.push(d(r));return t.join(\"\")}async function h(e){return s(\"space.readPage\",e)}var w=k(N(\"yaml\")),M=\"\\u{1F6AA} \",u=[];async function L(){let e=\"\";try{let{text:o}=await h(\"MOUNTS\");e=o}catch{u=[];return}let t=await l(e),r=P(t,\"CodeText\");if(!r){console.error(\"Could not find yaml block in MOUNTS\");return}let n=r.children[0].text,i=w.default.parse(n);if(!Array.isArray(i)){console.error(\"Invalid MOUNTS file, should have array of mount points\");return}for(let o of i){if(!o.prefix){console.error(\"Invalid mount point, no prefix specified\",o);return}if(!o.path){console.error(\"Invalid mount point, no path specified\",o);return}o.perm||(o.perm=\"rw\"),o.path.startsWith(\"file:\")?(o.protocol=\"file\",o.path=o.path.substring(5)):(o.protocol=\"http\",o.path+=\"/fs\")}u=i}async function O(e,t){t=`${M}${t}`;let r=await l(e);return f(r,n=>{if(n.type===\"WikiLinkPage\"){let i=n.children[0].text;i.startsWith(t)&&(n.children[0].text=i.substring(t.length))}}),d(r)}function W(e){e=e.substring(M.length);for(let t of u)if(e.startsWith(t.prefix))return{resolvedPath:`${t.path}/${e.substring(t.prefix.length)}`,mountPoint:t};throw new Error(\"No mount point found for \"+e)}async function x(e,t){await L();let{resolvedPath:r,mountPoint:n}=W(e);if(t=await O(t,n.prefix),n.protocol===\"file\"){let i=await m(`${r}.md`,t);return{name:e,lastModified:i.lastModified,perm:n.perm}}else{let i=await fetch(r,{method:\"PUT\",headers:S(n),body:t});if(i.status!==200)throw new Error(`Failed to write page: ${i.status}: ${await i.text()}`);return{name:e,lastModified:+(i.headers.get(\"Last-Modified\")||\"0\"),perm:i.headers.get(\"X-Permission\")||\"rw\"}}}function S(e){return{Authorization:e.password?`Bearer ${e.password}`:\"\"}}var A=x;return E(I);})();\n return mod;})()"
    },
    "deletePageMounted": {
      "pageNamespace": {
        "pattern": "^ðŸšª .+",
        "operation": "deletePage"
      },
      "code": "(() => { var mod=(()=>{var w=Object.create;var a=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var $=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var F=(e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})},f=(e,t,r,o)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of x(t))!T.call(e,n)&&n!==r&&a(e,n,{get:()=>t[n],enumerable:!(o=M(t,n))||o.enumerable});return e};var b=(e,t,r)=>(r=e!=null?w(y(e)):{},f(t||!e||!e.__esModule?a(r,\"default\",{value:e,enumerable:!0}):r,e)),N=e=>f(a({},\"__esModule\",{value:!0}),e);var O={};F(O,{default:()=>L});var d=self.syscall;async function u(e){return d(\"fs.deleteFile\",e)}typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;async function p(e){return s(\"markdown.parseMarkdown\",e)}function c(e,t){if(t(e))return[e];let r=[];if(e.children)for(let o of e.children)r=[...r,...c(o,t)];return r}function m(e,t){return c(e,r=>r.type===t)[0]}async function g(e){return s(\"space.readPage\",e)}var P=b($(\"yaml\")),v=\"\\u{1F6AA} \",l=[];async function k(){let e=\"\";try{let{text:i}=await g(\"MOUNTS\");e=i}catch{l=[];return}let t=await p(e),r=m(t,\"CodeText\");if(!r){console.error(\"Could not find yaml block in MOUNTS\");return}let o=r.children[0].text,n=P.default.parse(o);if(!Array.isArray(n)){console.error(\"Invalid MOUNTS file, should have array of mount points\");return}for(let i of n){if(!i.prefix){console.error(\"Invalid mount point, no prefix specified\",i);return}if(!i.path){console.error(\"Invalid mount point, no path specified\",i);return}i.perm||(i.perm=\"rw\"),i.path.startsWith(\"file:\")?(i.protocol=\"file\",i.path=i.path.substring(5)):(i.protocol=\"http\",i.path+=\"/fs\")}l=n}function E(e){e=e.substring(v.length);for(let t of l)if(e.startsWith(t.prefix))return{resolvedPath:`${t.path}/${e.substring(t.prefix.length)}`,mountPoint:t};throw new Error(\"No mount point found for \"+e)}async function h(e){await k();let{resolvedPath:t,mountPoint:r}=E(e);if(r.protocol===\"file\")if(r.perm===\"rw\")await u(`${t}.md`);else throw new Error(\"Deleting read-only page\");else throw new Error(\"Not yet implemented\")}var L=h;return N(O);})();\n return mod;})()"
    },
    "getPageMetaMounted": {
      "pageNamespace": {
        "pattern": "^ðŸšª .+",
        "operation": "getPageMeta"
      },
      "code": "(() => { var mod=(()=>{var w=Object.create;var a=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var $=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var F=(e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})},f=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let o of x(t))!T.call(e,o)&&o!==r&&a(e,o,{get:()=>t[o],enumerable:!(i=M(t,o))||i.enumerable});return e};var b=(e,t,r)=>(r=e!=null?w(y(e)):{},f(t||!e||!e.__esModule?a(r,\"default\",{value:e,enumerable:!0}):r,e)),N=e=>f(a({},\"__esModule\",{value:!0}),e);var W={};F(W,{default:()=>O});var d=self.syscall;async function u(e){return d(\"fs.getFileMeta\",e)}typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;async function p(e){return s(\"markdown.parseMarkdown\",e)}function c(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...c(i,t)];return r}function m(e,t){return c(e,r=>r.type===t)[0]}async function g(e){return s(\"space.readPage\",e)}var P=b($(\"yaml\")),v=\"\\u{1F6AA} \",l=[];async function k(){let e=\"\";try{let{text:n}=await g(\"MOUNTS\");e=n}catch{l=[];return}let t=await p(e),r=m(t,\"CodeText\");if(!r){console.error(\"Could not find yaml block in MOUNTS\");return}let i=r.children[0].text,o=P.default.parse(i);if(!Array.isArray(o)){console.error(\"Invalid MOUNTS file, should have array of mount points\");return}for(let n of o){if(!n.prefix){console.error(\"Invalid mount point, no prefix specified\",n);return}if(!n.path){console.error(\"Invalid mount point, no path specified\",n);return}n.perm||(n.perm=\"rw\"),n.path.startsWith(\"file:\")?(n.protocol=\"file\",n.path=n.path.substring(5)):(n.protocol=\"http\",n.path+=\"/fs\")}l=o}function E(e){e=e.substring(v.length);for(let t of l)if(e.startsWith(t.prefix))return{resolvedPath:`${t.path}/${e.substring(t.prefix.length)}`,mountPoint:t};throw new Error(\"No mount point found for \"+e)}function L(e){return{Authorization:e.password?`Bearer ${e.password}`:\"\"}}async function h(e){await k();let{resolvedPath:t,mountPoint:r}=E(e);if(r.protocol===\"file\"){let i=await u(`${t}.md`);return{name:e,lastModified:i.lastModified,perm:r.perm}}else{let i=await fetch(t,{method:\"OPTIONS\",headers:L(r)});if(i.status!==200)throw new Error(`Failed to list pages: ${i.status}: ${await i.text()}`);if(i.headers.get(\"X-Status\")===\"404\")throw new Error(\"Page not found\");return{name:e,lastModified:+(i.headers.get(\"Last-Modified\")||\"0\"),perm:i.headers.get(\"X-Permission\")||\"rw\"}}}var O=h;return N(W);})();\n return mod;})()"
    },
    "listPagesMounted": {
      "pageNamespace": {
        "pattern": "^ðŸšª .+",
        "operation": "listPages"
      },
      "code": "(() => { var mod=(()=>{var M=Object.create;var a=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var F=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var b=(e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})},f=(e,t,r,n)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let o of y(t))!$.call(e,o)&&o!==r&&a(e,o,{get:()=>t[o],enumerable:!(n=x(t,o))||n.enumerable});return e};var N=(e,t,r)=>(r=e!=null?M(T(e)):{},f(t||!e||!e.__esModule?a(r,\"default\",{value:e,enumerable:!0}):r,e)),v=e=>f(a({},\"__esModule\",{value:!0}),e);var O={};b(O,{default:()=>L});var d=self.syscall;async function u(e,t=!1){return d(\"fs.listFiles\",e,t)}typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var s=self.syscall;async function p(e){return s(\"markdown.parseMarkdown\",e)}function c(e,t){if(t(e))return[e];let r=[];if(e.children)for(let n of e.children)r=[...r,...c(n,t)];return r}function m(e,t){return c(e,r=>r.type===t)[0]}async function g(e){return s(\"space.readPage\",e)}var h=N(F(\"yaml\")),P=\"\\u{1F6AA} \",l=[];async function k(){let e=\"\";try{let{text:i}=await g(\"MOUNTS\");e=i}catch{l=[];return}let t=await p(e),r=m(t,\"CodeText\");if(!r){console.error(\"Could not find yaml block in MOUNTS\");return}let n=r.children[0].text,o=h.default.parse(n);if(!Array.isArray(o)){console.error(\"Invalid MOUNTS file, should have array of mount points\");return}for(let i of o){if(!i.prefix){console.error(\"Invalid mount point, no prefix specified\",i);return}if(!i.path){console.error(\"Invalid mount point, no path specified\",i);return}i.perm||(i.perm=\"rw\"),i.path.startsWith(\"file:\")?(i.protocol=\"file\",i.path=i.path.substring(5)):(i.protocol=\"http\",i.path+=\"/fs\")}l=o}function E(e){return{Authorization:e.password?`Bearer ${e.password}`:\"\"}}async function w(){await k();let e=[];for(let t of l)if(t.protocol===\"file\"){let r=await u(t.path,!0);for(let n of r)!n.name.endsWith(\".md\")||e.push({name:`${P}${t.prefix}${n.name.substring(0,n.name.length-3)}`,lastModified:n.lastModified,perm:t.perm})}else{let r=await fetch(t.path,{headers:E(t)});if(r.status!==200)throw new Error(`Failed to list pages: ${r.status}: ${await r.text()}`);let n=await r.json();for(let o of n)o.name.startsWith(\"_\")||e.push({name:`${P}${t.prefix}${o.name}`,lastModified:o.lastModified,perm:t.perm})}return e}var L=w;return v(O);})();\n return mod;})()"
    }
  }
}